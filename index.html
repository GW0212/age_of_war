<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>í”Œë˜ì‹œ ê²Œì„ ëŸ°ì²˜ â€“ Ruffle + í–„ë²„ê±° ë©”ë‰´</title>
  <meta name="description" content="ì—¬ëŸ¬ ê°œì˜ SWF í”Œë˜ì‹œ ê²Œì„ì„ í•œ í˜ì´ì§€ì—ì„œ ì„ íƒí•´ ì‹¤í–‰í•˜ëŠ” ëŸ°ì²˜. Ruffle ì—ë®¬ë ˆì´í„° ì‚¬ìš©." />
  <!-- âœ… Favicon (í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— favicon.png 16x16 ë‘ì„¸ìš”) -->
  <link rel="icon" type="image/png" sizes="16x16" href="favicon.png" />
  <style>
    :root{
      --bg:#0b0f14;--panel:#131922;--muted:#8aa0b3;--text:#e8eef5;--accent:#59b1ff;
      --border:rgba(255,255,255,.1);--shadow:0 8px 40px rgba(0,0,0,.35)
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:radial-gradient(1200px 800px at 80% -20%, #132033 0%, var(--bg) 60%);
      color:var(--text);
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Noto Sans KR,Apple SD Gothic Neo,"ë§‘ì€ ê³ ë”•",Arial,"Helvetica Neue"
    }
    header{
      position:sticky;top:0;z-index:50;
      display:flex;align-items:center;gap:10px;
      padding:12px 14px;
      border-bottom:1px solid var(--border);
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,0));
    }
    .hamburger{
      display:inline-flex;flex:none;width:40px;height:40px;border-radius:10px;
      border:1px solid var(--border);background:#0e1520;cursor:pointer;
      align-items:center;justify-content:center
    }
    .hamburger:active{transform:translateY(1px)}
    .title{font-weight:800;letter-spacing:.2px}
    .muted{color:var(--muted)}

    .wrap{max-width:1100px;margin:12px auto;padding:0 14px 24px;display:grid;gap:12px}
    .toolbar{
      display:flex;flex-wrap:wrap;gap:8px;align-items:center;
      background:rgba(19,25,34,.9);border:1px solid var(--border);
      border-radius:14px;padding:10px
    }
    button,label.btn{
      appearance:none;border:1px solid var(--border);background:#0d141d;color:var(--text);
      padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700;letter-spacing:.2px;
      display:inline-flex;gap:8px;align-items:center
    }
    button:hover,label.btn:hover{border-color:rgba(255,255,255,.22);background:#101a26}
    .btn-accent{border-color:rgba(89,177,255,.5);box-shadow:inset 0 0 0 1px rgba(89,177,255,.25)}
    input[type=range]{accent-color:var(--accent)}

    .player-shell{
      background:#0b121a;border:1px solid var(--border);border-radius:18px;
      overflow:hidden;position:relative;box-shadow:var(--shadow)
    }
    .stage{
      position:relative;width:100%;aspect-ratio:4/3;max-height:calc(100dvh - 230px);
      display:grid;place-items:center;
      background:repeating-conic-gradient(from 0deg,#0e1620 0 10deg,#0d141d 10deg 20deg)
    }
    .stage .hint{position:absolute;bottom:8px;right:8px;color:var(--muted);font-size:12px}

    /* ğŸ”» í–„ë²„ê±° ë“œë¡œì–´ */
    .drawer-back{
      position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;
      /* âœ… ë¸”ëŸ¬ ì™„ì „ ì œê±° */
      backdrop-filter:none !important;
      -webkit-backdrop-filter:none !important;
    }
    .drawer{
      position:fixed;inset:0 30% 0 0;max-width:360px;background:#0e1520;
      border-right:1px solid var(--border);box-shadow:var(--shadow);
      transform:translateX(-100%);transition:transform .2s ease;
      display:flex;flex-direction:column
    }
    .drawer.open~.drawer-back{display:block}
    .drawer.open{transform:none}
    .drawer header{position:static;border-bottom:1px solid var(--border)}
    .search{display:flex;gap:8px;padding:12px 12px 10px}
    .search input{
      flex:1 1 auto;height:40px;border-radius:10px;border:1px solid var(--border);
      background:#0b1216;color:var(--text);padding:0 12px
    }
    .game-list{overflow:auto;padding:6px 10px 14px;display:grid;gap:6px}
    .game-item{
      display:flex;gap:10px;align-items:center;padding:10px;border-radius:10px;
      border:1px solid var(--border);background:#0c131c;cursor:pointer
    }
    .game-item:hover{border-color:rgba(255,255,255,.22);background:#101a26}
    .game-item small{color:var(--muted)}

    .file-warn{
      display:none;margin:0 14px 0;padding:14px;border:1px dashed rgba(255,255,255,.25);
      border-radius:12px;background:linear-gradient(135deg, rgba(255,99,99,.1), rgba(255,166,0,.08))
    }
    .file-warn code{background:rgba(0,0,0,.35);padding:2px 6px;border-radius:6px}

    /* âœ… ì˜¤ë¥˜ í† ìŠ¤íŠ¸ */
    .toast{
      position:fixed;left:50%;bottom:24px;transform:translateX(-50%);
      background:#1a2432;color:#fff;border:1px solid rgba(255,255,255,.18);
      padding:10px 14px;border-radius:10px;font-size:14px;z-index:1000;max-width:92%;
      box-shadow:var(--shadow)
    }

    @media (max-width:880px){
      .drawer{inset:0 12% 0 0;max-width:86%}
    }
  </style>
</head>
<body>
  <header>
    <button id="btnMenu" class="hamburger" title="ê²Œì„ ë©”ë‰´ ì—´ê¸°" aria-label="ê²Œì„ ë©”ë‰´ ì—´ê¸°">â˜°</button>
    <div class="title">í”Œë˜ì‹œ ê²Œì„ ëŸ°ì²˜</div>
    <div class="muted">Ruffle â€¢ ì—¬ëŸ¬ SWF ì„ íƒ ì‹¤í–‰</div>
    <span style="flex:1 1 auto"></span>
    <span class="muted" style="font-size:12px">ë‹¨ì¶•í‚¤: M(ë©”ë‰´), F(ì „ì²´í™”ë©´)</span>
  </header>

  <main class="wrap">
    <div class="toolbar" role="group" aria-label="í”Œë ˆì´ì–´ ì œì–´">
      <label class="btn btn-accent" for="fileInput">SWF ë¶ˆëŸ¬ì˜¤ê¸°</label>
      <input id="fileInput" type="file" accept=".swf" hidden />

      <button id="btnDefault" class="btn">ê¸°ë³¸ ê²Œì„ ì‹¤í–‰</button>
      <button id="btnFullscreen" class="btn">ì „ì²´ í™”ë©´</button>
      <span style="width:8px"></span>
      <span class="muted" style="font-size:13px">ë°°ìœ¨</span>
      <input id="zoom" type="range" min="50" max="200" value="100" />
      <span id="zoomVal" style="width:44px;text-align:right;font-variant-numeric:tabular-nums">100%</span>
      <button id="btnFit" class="btn">ì°½ì— ë§ì¶”ê¸°</button>
      <button id="btnReset" class="btn">ì´ˆê¸°í™”</button>
      <span style="flex:1 1 auto"></span>
      <button id="btnReload" class="btn">ë‹¤ì‹œ ì‹¤í–‰</button>
      <button id="btnClear" class="btn" title="ì„¸ì´ë¸Œ/ìºì‹œ ì´ˆê¸°í™”">ìºì‹œ ì´ˆê¸°í™”</button>
    </div>

    <div class="player-shell">
      <div id="stage" class="stage" tabindex="0" aria-label="ê²Œì„ ë¬´ëŒ€ (í´ë¦­ í›„ í‚¤/ë§ˆìš°ìŠ¤ ì…ë ¥)">
        <div class="hint">SWFë¥¼ ë“œë˜ê·¸í•´ë„ ë©ë‹ˆë‹¤</div>
      </div>
    </div>

    <p class="muted" style="font-size:12.5px;line-height:1.6;text-align:center">
      âš ï¸ ì´ í˜ì´ì§€ëŠ” Flash ì›ë³¸(SWF)ì´ <b>ë²•ì ìœ¼ë¡œ í—ˆìš©ëœ ë²”ìœ„</b> ë‚´ì—ì„œë§Œ ì‚¬ìš©ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
      ì—”ì§„: <a href="https://ruffle.rs" target="_blank" rel="noreferrer noopener" style="color:var(--accent)">Ruffle</a>
    </p>

    <div id="fileProtoWarning" class="file-warn">
      <b>ì§€ê¸ˆ <code>file://</code>ë¡œ ì—´ë ¤ ìˆì–´ Ruffleê°€ ë§‰í˜”ìŠµë‹ˆë‹¤.</b> ì•„ë˜ ì¤‘ í•˜ë‚˜ë¡œ ì—´ì–´ì£¼ì„¸ìš”:
      <ol style="margin:8px 0 0 18px;line-height:1.6">
        <li><b>GitHub Pages</b>ì— ì—…ë¡œë“œí•˜ì—¬ httpsë¡œ ì ‘ì†</li>
        <li><b>VS Code</b> â†’ Live Server</li>
        <li><b>Python</b>: í´ë”ì—ì„œ <code>python -m http.server 8000</code> â†’ <code>http://localhost:8000</code></li>
      </ol>
    </div>
  </main>

  <!-- ì™¼ìª½ í–„ë²„ê±° ë“œë¡œì–´ -->
  <aside id="drawer" class="drawer" aria-hidden="true">
    <header>
      <div class="search">
        <input id="q" type="search" placeholder="ê²Œì„ ê²€ìƒ‰ (í•œê¸€/ì˜ë¬¸)" />
        <button id="btnClose" class="hamburger" aria-label="ë‹«ê¸°">âœ•</button>
      </div>
    </header>
    <div id="gameList" class="game-list" role="listbox" aria-label="ê²Œì„ ëª©ë¡"></div>
  </aside>
  <div id="backdrop" class="drawer-back"></div>

  <!-- Ruffle -->
  <script src="https://unpkg.com/@ruffle-rs/ruffle"></script>
  <script>
    // ================== ì„¤ì •: ì—¬ê¸° ëª©ë¡ë§Œ í¸ì§‘í•˜ë©´ ë¨ ==================
    // íŒŒì¼ì€ assets/ í´ë”ì— ìœ„ì¹˜. titleì€ í‘œì‹œëª…, fileì€ ìƒëŒ€ê²½ë¡œ
    const GAMES = [
      { id:'age_of_war',    title:'ì „ìŸì‹œëŒ€ 1 (Age of War)',     file:'assets/age_of_war.swf' },
      { id:'alien_hominid', title:'Alien Hominid',               file:'assets/alien_hominid.swf' },
      { id:'samurai_jack',  title:'Samurai Jack',                file:'assets/Samurai_Jack.swf' },
      // í•„ìš”í•˜ë©´ ììœ ë¡­ê²Œ ì¶”ê°€
    ];
    // ì´ˆê¸° ê¸°ë³¸ ì‹¤í–‰ íƒ€ê¹ƒ (ì—†ìœ¼ë©´ ì²« í•­ëª© ì‚¬ìš©)
    const DEFAULT_GAME_ID = localStorage.getItem('last_game_id') || GAMES[0]?.id;

    // ================== ìš”ì†Œ ì°¸ì¡° ==================
    const stage = document.getElementById('stage');
    const zoom = document.getElementById('zoom');
    const zoomVal = document.getElementById('zoomVal');
    const btnFit = document.getElementById('btnFit');
    const btnReset = document.getElementById('btnReset');
    const btnReload = document.getElementById('btnReload');
    const btnClear = document.getElementById('btnClear');
    const btnFs = document.getElementById('btnFullscreen');
    const btnDefault = document.getElementById('btnDefault');
    const fileInput = document.getElementById('fileInput');

    const drawer = document.getElementById('drawer');
    const backdrop = document.getElementById('backdrop');
    const btnMenu = document.getElementById('btnMenu');
    const btnClose = document.getElementById('btnClose');
    const listEl = document.getElementById('gameList');
    const q = document.getElementById('q');

    let rufflePlayer = null;
    let scale = 1;
    let currentSrc = null; // URL ë¬¸ìì—´ ë˜ëŠ” {data:ArrayBuffer}

    // file:// ê²½ê³ 
    document.addEventListener('DOMContentLoaded', ()=>{
      if (location.protocol === 'file:') {
        document.getElementById('fileProtoWarning').style.display = 'block';
      }
    });

    // ìœ í‹¸: í† ìŠ¤íŠ¸
    function toast(msg){
      const t = document.createElement('div');
      t.className = 'toast'; t.textContent = msg;
      document.body.appendChild(t);
      setTimeout(()=>{ t.remove(); }, 3800);
    }

    // ìœ í‹¸: ì ˆëŒ€ URLë¡œ ë³€í™˜ (ì„œë¸Œ ê²½ë¡œì—ì„œë„ ì•ˆì „)
    function resolveUrl(path){
      return new URL(path, document.baseURI).toString();
    }

    // ë¡œë“œ ì „ì— íŒŒì¼ ì¡´ì¬ í™•ì¸ (HEAD) â†’ ì„±ê³µ ì‹œ ë¡œë“œ
    async function checkAndLoad(path){
      const url = resolveUrl(path);
      try {
        const res = await fetch(url, { method: 'HEAD', cache: 'no-store' });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        loadFromUrl(url);
      } catch (e) {
        console.error('SWF ì‚¬ì „ í™•ì¸ ì‹¤íŒ¨:', url, e);
        toast(`SWFë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${path} (${e.message}).\nê²½ë¡œ/ëŒ€ì†Œë¬¸ì/ë°°í¬ í¬í•¨ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì„¸ìš”.`);
        alert(`SWF ë¡œë“œ ì‹¤íŒ¨\n- ìš”ì²­ URL: ${url}\n- ì›ì¸: ${e.message}\n\ní™•ì¸ ì‚¬í•­\n1) íŒŒì¼ì´ repoì— ì»¤ë°‹/í‘¸ì‹œ ë˜ì—ˆëŠ”ì§€\n2) ê²½ë¡œì— 'assets/'ê°€ í¬í•¨ë˜ëŠ”ì§€\n3) íŒŒì¼ëª… ëŒ€ì†Œë¬¸ìê°€ ì •í™•í•œì§€ (GitHub PagesëŠ” êµ¬ë¶„í•¨)\n4) ë°°í¬ ì™„ë£Œ í›„ ìºì‹œê°€ ë‚¨ì•„ìˆì§€ ì•Šì€ì§€ (Ctrl+Shift+R)`);
      }
    }

    // í”Œë ˆì´ì–´ ìƒì„±
    function makePlayer(){
      stage.querySelectorAll('ruffle-player, object, embed, canvas').forEach(n=>n.remove());
      const ruffle = window.RufflePlayer?.newest();
      rufflePlayer = ruffle.createPlayer();
      rufflePlayer.style.width = '100%';
      rufflePlayer.style.height = '100%';
      rufflePlayer.style.transformOrigin = 'center center';
      stage.appendChild(rufflePlayer);
      stage.addEventListener('click',()=>stage.focus());
    }

    // ì‹¤ì œ ë¡œë“œ
    function loadFromUrl(url){
      currentSrc = url;
      if(!rufflePlayer) makePlayer();
      rufflePlayer.load(url).then(()=>{
        saveLastGame(url);
      }).catch(err=>{
        console.error('SWF ë¡œë“œ ì‹¤íŒ¨', err);
        toast('Ruffleì´ SWFë¥¼ ë¡œë“œí•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.');
        alert('Ruffleì´ SWFë¥¼ ë¡œë“œí•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\n' + (err?.message || err));
      });
    }
    function loadFromFile(file){
      if(!file) return;
      const reader = new FileReader();
      reader.onload = (e)=>{
        currentSrc = {data:e.target.result};
        if(!rufflePlayer) makePlayer();
        rufflePlayer.load(currentSrc).catch(err=>{
          alert('SWF íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨'); console.error(err);
        });
      };
      reader.readAsArrayBuffer(file);
    }

    // ë°°ìœ¨
    function setScale(percent){
      scale = Math.max(.5, Math.min(2, percent/100));
      zoomVal.textContent = Math.round(scale*100)+'%';
      const playerEl = stage.querySelector('ruffle-player');
      if(playerEl) playerEl.style.transform = `scale(${scale})`;
    }
    function fitToStage(){
      const playerEl = stage.querySelector('ruffle-player'); if(!playerEl) return;
      const rect = stage.getBoundingClientRect(); const baseW=800, baseH=600; // 4:3
      const s = Math.min(rect.width/baseW, rect.height/baseH);
      zoom.value = Math.round(s*100); setScale(zoom.value);
    }

    function reload(){
      if(!rufflePlayer) return; // currentSrc ìœ ì§€
      if(typeof currentSrc === 'string') loadFromUrl(currentSrc);
      else if(currentSrc && currentSrc.data) { makePlayer(); rufflePlayer.load(currentSrc); }
    }
    function clearCaches(){
      try{
        localStorage.clear(); sessionStorage.clear();
        caches?.keys?.().then(keys=>keys.forEach(k=>caches.delete(k)));
      }catch(e){}
      toast('ë¡œì»¬ ì €ì¥(ì„¸ì´ë¸Œ/ìºì‹œ) ì´ˆê¸°í™” ì™„ë£Œ');
    }

    function openMenu(){ drawer.classList.add('open'); drawer.setAttribute('aria-hidden','false'); backdrop.style.display='block'; q.focus(); }
    function closeMenu(){ drawer.classList.remove('open'); drawer.setAttribute('aria-hidden','true'); backdrop.style.display='none'; }

    // ëª©ë¡ ë Œë”ë§
    function renderList(filter=''){
      listEl.innerHTML='';
      const f = filter.trim().toLowerCase();
      GAMES
        .filter(g => !f || g.title.toLowerCase().includes(f) || g.id.toLowerCase().includes(f))
        .forEach(g => {
          const li = document.createElement('div');
          li.className='game-item'; li.role='option'; li.tabIndex=0;
          li.innerHTML = `<div><div style="font-weight:800">${g.title}</div><small>${g.file}</small></div>`;
          li.addEventListener('click',()=>{ checkAndLoad(g.file); closeMenu(); });
          li.addEventListener('keydown',(e)=>{ if(e.key==='Enter') { checkAndLoad(g.file); closeMenu(); } });
          listEl.appendChild(li);
        });
      // íŒŒì¼ ì—…ë¡œë“œ í•­ëª©
      const up = document.createElement('div');
      up.className='game-item';
      up.innerHTML = '<div><div style="font-weight:800">ë‚´ SWF ì—…ë¡œë“œâ€¦</div><small>ë¡œì»¬ íŒŒì¼ì—ì„œ ì‹¤í–‰</small></div>';
      up.addEventListener('click',()=> fileInput.click());
      listEl.appendChild(up);
    }

    function saveLastGame(url){
      try{
        const found = GAMES.find(g=>resolveUrl(g.file)===url || g.file===url);
        if(found) localStorage.setItem('last_game_id', found.id);
      }catch(e){}
    }

    // ì´ë²¤íŠ¸ ë°”ì¸ë”©
    window.addEventListener('DOMContentLoaded',()=>{
      makePlayer(); setScale(100); renderList();
      if(DEFAULT_GAME_ID){
        const g=GAMES.find(x=>x.id===DEFAULT_GAME_ID) || GAMES[0];
        if(g) checkAndLoad(g.file);
      }
    });
    zoom.addEventListener('input', e=>setScale(e.target.value));
    btnFit.addEventListener('click', fitToStage);
    btnReset.addEventListener('click', ()=>{ zoom.value=100; setScale(100); });
    btnReload.addEventListener('click', reload);
    btnClear.addEventListener('click', clearCaches);
    btnFs.addEventListener('click', ()=>{
      if(stage.requestFullscreen) stage.requestFullscreen();
      else stage.webkitRequestFullscreen && stage.webkitRequestFullscreen();
    });
    btnDefault.addEventListener('click', ()=>{
      const g=GAMES.find(x=>x.id===DEFAULT_GAME_ID) || GAMES[0];
      if(g) checkAndLoad(g.file);
    });
    fileInput.addEventListener('change', e=> loadFromFile(e.target.files?.[0]));

    // ë“œë˜ê·¸ ì•¤ ë“œë¡­
    ['dragenter','dragover'].forEach(t=>stage.addEventListener(t,(e)=>{e.preventDefault();e.stopPropagation();}));
    stage.addEventListener('drop',(e)=>{
      e.preventDefault();e.stopPropagation();
      const f=[...(e.dataTransfer?.files||[])].find(x=>x.name.endsWith('.swf'));
      if(f) loadFromFile(f);
    });

    // ë©”ë‰´
    btnMenu.addEventListener('click', openMenu);
    btnClose.addEventListener('click', closeMenu);
    backdrop.addEventListener('click', closeMenu);
    q.addEventListener('input', ()=>renderList(q.value));

    // ë‹¨ì¶•í‚¤
    window.addEventListener('keydown',(e)=>{
      if(e.key.toLowerCase()==='m') { e.preventDefault(); drawer.classList.contains('open')?closeMenu():openMenu(); }
      if(e.key.toLowerCase()==='f') { e.preventDefault(); if(stage.requestFullscreen) stage.requestFullscreen(); }
      if(e.key==='Escape' && drawer.classList.contains('open')) closeMenu();
    });
  </script>
</body>
</html>
